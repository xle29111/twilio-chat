name: Detect Changes Between Tags

on:
  workflow_dispatch:
    inputs:
      new_release:
        description: 'Enter the new tag version (e.g., v1.1.4)'
        required: true

jobs:
  detect-changes:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get latest release tag
      id: get_latest_release
      shell: bash
      run: |
        latest_release=$(git describe --tags `git rev-list --tags --max-count=1`)
        echo "Latest release: $latest_release"
        echo "::set-output name=latest_release::$latest_release"

    - name: Detect changes between tags
      id: detect_changes
      shell: bash
      run: |
        new_release=${{ github.event.inputs.new_release }}
        latest_release=${{ steps.get_latest_release.outputs.latest_release }}

        echo "Comparing changes between $new_release and $latest_release..."
        
        changes=$(git diff --name-only $latest_release $new_release -- my-project/resources/)
        echo "Changed directories:"
        echo "$changes"

        modified_dirs=$(echo "$changes" | grep -oE '^my-project/resources/[^/]*' | sort -u)
        echo "$new_release: ${modified_dirs//my-project\/resources\//}" > changes.txt
        cat changes.txt

    - name: Create new release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.event.inputs.new_release }}
        release_name: ${{ github.event.inputs.new_release }}
        body: |
          Changes detected in this release:
          $(cat changes.txt)